(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-chat-user-mgr"],{"1d92":function(t,e,i){"use strict";i.r(e);var a=i("c5aa"),s=i("8131");for(var n in s)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(n);var r=i("f0c5"),c=Object(r["a"])(s["default"],a["b"],a["c"],!1,null,"ba8d246e",null,!1,a["a"],void 0);e["default"]=c.exports},"40b3":function(module,exports,__webpack_require__){"use strict";__webpack_require__("7a82");var _interopRequireDefault=__webpack_require__("4ea4").default;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,__webpack_require__("e25e"),__webpack_require__("4de4"),__webpack_require__("d3b7"),__webpack_require__("159b"),__webpack_require__("14d9"),__webpack_require__("4e82"),__webpack_require__("99af");var _objectSpread2=_interopRequireDefault(__webpack_require__("5530")),_api=__webpack_require__("99bd"),_vuex=__webpack_require__("26cb"),_MessageType=__webpack_require__("7f8e"),_utils=__webpack_require__("d648");(0,_utils.getHeadPic)();var _default={data:function(){return{switchA:!1,switchB:!1,switchC:!1,id:"",cur_user:{},super_user:0,user_note:""}},onShow:function(){this.loadName()},computed:(0,_objectSpread2.default)((0,_objectSpread2.default)((0,_objectSpread2.default)({i18n:function(){return this.$t("index")}},(0,_vuex.mapState)("chat",["curChatMsgList","chatMyLoadding","chatMessageMap","arList"])),(0,_vuex.mapState)("user",["friendList"])),(0,_vuex.mapState)("app",["imgUrl","reqUrl"])),onLoad:function onLoad(e){var _this2=this;this.id=e.id;var _this=this;(0,_api.loadTalkUserById)({id:this.id}).then((function(res){var res_data=eval(res.data);200==res_data.code&&(_this.cur_user=res_data.body,_this2.loadName())})).catch((function(t){uni.showToast({icon:"none",position:"bottom",title:t.msg?t.msg:"服务器异常!"})})),(0,_api.isSuperUser)().then((function(res){var res_data=eval(res.data);200==res_data.code&&(_this.super_user=parseInt(res_data.msg))})).catch((function(t){uni.showToast({icon:"none",position:"bottom",title:t.msg?t.msg:"服务器异常!"})})),(0,_api.isBlack)({uid:this.id}).then((function(res){var res_data=eval(res.data);200==res_data.code?"1"==res_data.msg?_this.switchC=!0:_this.switchC=!1:uni.showToast({title:res_data.msg,duration:2e3})})).catch((function(t){uni.showToast({icon:"none",position:"bottom",title:t.msg?t.msg:"服务器异常!"})}));var darao=uni.getStorageSync(this.id+"_darao");darao&&""!=darao&&(this.switchA=darao);var zhiding=uni.getStorageSync(this.id+"_zhiding");zhiding&&""!=zhiding&&(this.switchB=zhiding)},methods:(0,_objectSpread2.default)((0,_objectSpread2.default)((0,_objectSpread2.default)((0,_objectSpread2.default)({},(0,_vuex.mapMutations)("chat",["deleteMessage","setCurChatMsgList","setArList","setArListShow"])),(0,_vuex.mapMutations)("user",["setFriendList"])),(0,_vuex.mapActions)("socket",["WEBSOCKET_SEND"])),{},{getHeadPic:function(t){return(0,_utils.getHeadPic)(t,this.imgUrl)},loadName:function(){var t=uni.getStorageSync(this.id+"_NOTE");t&&""!=t&&(this.user_note=t,_this.cur_user.nickName=t)},removeFriend:function removeFriend(){var _this=this,user=uni.getStorageSync("USER");uni.showActionSheet({itemList:["删除并清除聊天记录"],success:function success(res){(0,_api.removeFriends)({uid:_this.id}).then((function(res){var res_data=eval(res.data);200==res_data.code?(uni.showToast({title:"删除成功",duration:800}),setTimeout((function(){_this.deleteMessage(user.id+"#"+_this.id),uni.removeStorageSync(user.id+"#"+_this.id+"_CHAT_MESSAGE"),_this.setCurChatMsgList([]),uni.removeStorageSync(user.id+"#"+_this.id+"_CHAT_MESSAGE_LASTCONTENT"),uni.removeStorageSync(user.id+"#"+_this.id+"_CHAT_MESSAGE_UNREAD");var t=_this.arList.filter((function(t){return t.id!=_this.id}));_this.setArList(t);var e=_this.friendList;e=e.filter((function(t){var e=t.list.filter((function(t){return t.member_uuid!=_this.id}));return t.list=e,!(t.list.length<=0)})),_this.setFriendList(e),uni.navigateTo({url:"/pages/index/index"})}),800)):uni.showToast({title:res_data.msg,duration:2e3})})).catch((function(t){uni.showToast({icon:"none",position:"bottom",title:t.msg?t.msg:"服务器异常!"})}))},fail:function(t){}})},editNote:function(){uni.navigateTo({url:"/pages/chat/user/note?fid="+this.id})},createGroup:function(){uni.navigateTo({url:"/pages/chat/group/createGroup?fid="+this.id})},goMsgRecord:function(){uni.navigateTo({url:"/pages/chat/user/message_record?id="+this.id})},clearChatMsg:function(){var t=this,e=uni.getStorageSync("USER");uni.showModal({title:"请确认",content:"是否清空聊天记录?",success:function(i){i.confirm&&(t.chatMessageMap.delete(e.id+"#"+t.id),uni.removeStorageSync(e.id+"#"+t.id+"_CHAT_MESSAGE"),t.setCurChatMsgList([]),uni.removeStorageSync(e.id+"#"+t.id+"_CHAT_MESSAGE_LASTCONTENT"),uni.removeStorageSync(e.id+"#"+t.id+"_CHAT_MESSAGE_UNREAD"),uni.showToast({title:"清除成功",duration:2e3}),t.WEBSOCKET_SEND({body:e.id+"#"+t.id,CMD:_MessageType.MessageType.CLEAR_CHAT_MSG_SINGLE_CLOUD}))}})},clearChatMsgBoth:function(){var t=this,e=uni.getStorageSync("USER");uni.showModal({title:"请确认",content:"是否双向清空聊天记录?",success:function(i){i.confirm&&(t.chatMessageMap.delete(e.id+"#"+t.id),uni.removeStorageSync(e.id+"#"+t.id+"_CHAT_MESSAGE"),t.setCurChatMsgList([]),uni.removeStorageSync(e.id+"#"+t.id+"_CHAT_MESSAGE_LASTCONTENT"),uni.removeStorageSync(e.id+"#"+t.id+"_CHAT_MESSAGE_UNREAD"),uni.showToast({title:"清除成功",duration:2e3}),t.WEBSOCKET_SEND({body:e.id+"#"+t.id,CMD:_MessageType.MessageType.CLEAR_CHAT_MSG}))}})},SwitchA:function(t){this.switchA=t.detail.value,uni.setStorageSync(this.id+"_darao",t.detail.value)},SwitchC:function SwitchC(e){var _this=this,user=uni.getStorageSync("USER");this.switchC=e.detail.value;var actionName="";actionName=this.switchC?"addBlack":"removeBlack",(0,_api.userDoBlack)(actionName,{uid:this.id}).then((function(res){var res_data=eval(res.data);200==res_data.code||uni.showToast({title:res_data.msg,duration:2e3})})).catch((function(t){uni.showToast({icon:"none",position:"bottom",title:t.msg?t.msg:"服务器异常!"})}))},SwitchB:function(t){this.switchB=t.detail.value,uni.setStorageSync(this.id+"_zhiding",t.detail.value);var e=this.arList,i=[],a=[];e.forEach((function(t){var e=uni.getStorageSync(t.id+"_zhiding");e?(t.top=0,a.push(t)):i.push(t)})),i.sort((function(t,e){return e.createDateTime-t.createDateTime})),a.sort((function(t,e){return e.createDateTime-t.createDateTime})),this.setArListShow(a.concat(i))}})};exports.default=_default},8131:function(t,e,i){"use strict";i.r(e);var a=i("40b3"),s=i.n(a);for(var n in a)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(n);e["default"]=s.a},c5aa:function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){}));var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("cu-custom",{attrs:{bgColor:"bg-blue",isBack:!0,nameToLeft:!0}},[i("template",{attrs:{slot:"backText"},slot:"backText"}),i("template",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(t.i18n.setting))]),i("template",{attrs:{slot:"right"},slot:"right"})],2),i("v-uni-view",{staticClass:"margin-top",staticStyle:{background:"#fff",display:"flex",width:"96%",margin:"auto auto","margin-top":"10px!important"}},[i("v-uni-view",{staticStyle:{width:"150upx","padding-top":"30upx","padding-bottom":"30upx","margin-left":"10upx"}},[i("v-uni-view",{staticClass:"cu-avatar radius margin-left",style:"height:100upx;width:100upx;background-image:url("+t.getHeadPic(t.cur_user.headpic)+");"}),i("v-uni-view",{staticStyle:{margin:"auto auto",color:"#999","font-size":"24upx","text-align":"center","margin-top":"8upx",overflow:"hidden",height:"34upx",width:"100upx"}},[t._v(t._s(t.cur_user.nickName))])],1),i("v-uni-text",{staticClass:"iconfont icon-tianjiatupian",staticStyle:{"font-size":"120upx","margin-top":"20upx",color:"#999","margin-left":"20upx"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.createGroup()}}})],1),i("v-uni-view",{staticClass:"cu-list menu",staticStyle:{clear:"both",width:"96%",margin:"auto auto","margin-top":"10px!important"}},[i("v-uni-view",{staticClass:"cu-item arrow",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.editNote()}}},[i("v-uni-view",{staticClass:"content"},[i("v-uni-text",{staticClass:"text-grey",staticStyle:{color:"#333",float:"left"}},[t._v(t._s(t.i18n.remark))]),i("v-uni-text",{staticClass:"text-grey text-sm",staticStyle:{float:"right",color:"#aaa","font-size":"26upx"}},[t._v(t._s(t.user_note))])],1)],1),i("v-uni-view",{staticClass:"cu-item arrow",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.goMsgRecord()}}},[i("v-uni-view",{staticClass:"content"},[i("v-uni-text",{staticClass:"text-grey",staticStyle:{color:"#333"}},[t._v(t._s(t.i18n.sychronize))])],1)],1),i("v-uni-view",{staticClass:"cu-form-group margin-top"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(t.i18n.nodisurb))]),i("v-uni-switch",{class:t.switchA?"checked":"",attrs:{checked:!!t.switchA},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.SwitchA.apply(void 0,arguments)}}})],1),i("v-uni-view",{staticClass:"cu-item cu-form-group"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(t.i18n.stickychat))]),i("v-uni-switch",{class:t.switchB?"checked":"",attrs:{checked:!!t.switchB},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.SwitchB.apply(void 0,arguments)}}})],1),i("v-uni-view",{staticClass:"cu-item cu-form-group"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(t.i18n.addblacklist))]),i("v-uni-switch",{class:t.switchC?"checked":"",attrs:{checked:!!t.switchC},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.SwitchC.apply(void 0,arguments)}}})],1),i("v-uni-view",{staticClass:"cu-item margin-top arrow",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clearChatMsg()}}},[i("v-uni-view",{staticClass:"content"},[i("v-uni-text",{staticClass:"text-grey",staticStyle:{color:"#333"}},[t._v(t._s(t.i18n.clearchat))])],1)],1),1==t.super_user?i("v-uni-view",{staticClass:"cu-item arrow",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clearChatMsgBoth()}}},[i("v-uni-view",{staticClass:"content"},[i("v-uni-text",{staticClass:"text-grey",staticStyle:{color:"#333"}},[t._v(t._s(t.i18n.clearallchat))])],1)],1):t._e(),i("v-uni-view",{staticClass:"cu-item margin-top",staticStyle:{"margin-bottom":"80upx"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.removeFriend()}}},[i("v-uni-view",{staticClass:"content",staticStyle:{"text-align":"center"}},[i("v-uni-text",{staticClass:"text-grey",staticStyle:{color:"#FF2442"}},[t._v(t._s(t.i18n.delete))])],1)],1)],1)],1)},s=[]}}]);