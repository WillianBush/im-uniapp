(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-chat-group-message_record"],{6768:function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return a}));var a={uParse:i("81b6").default},r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",[i("cu-custom",{attrs:{bgColor:"bg-blue",isBack:!0,nameToLeft:!0}},[i("template",{attrs:{slot:"backText"},slot:"backText"}),i("template",{attrs:{slot:"content"},slot:"content"},[e._v("历史聊天记录")]),i("template",{attrs:{slot:"right"},slot:"right"})],2),i("v-uni-view",{staticClass:"cu-chat"},[e.chatLogs.length<=0?i("v-uni-view",{staticStyle:{"text-align":"center",color:"#aaa","margin-top":"60upx","font-size":"28upx"}},[e._v("暂无聊天记录")]):e._e(),i("v-uni-scroll-view",{attrs:{"scroll-y":!0,"refresher-enabled":!1,"refresher-triggered":e.refresherTriggered},on:{refresherrefresh:function(t){arguments[0]=t=e.$handleEvent(t),e.refresherrefresh.apply(void 0,arguments)},refresherrestore:function(t){arguments[0]=t=e.$handleEvent(t),e.refresherrestore.apply(void 0,arguments)},refresherabort:function(t){arguments[0]=t=e.$handleEvent(t),e.refresherabort.apply(void 0,arguments)},scrolltolower:function(t){arguments[0]=t=e.$handleEvent(t),e.scrollLower.apply(void 0,arguments)}}},[e._l(e.chatLogs,(function(t,a){return[t.opt&&"undo"==t.opt?[i("v-uni-view",{staticStyle:{display:"none"}})]:"SYS_TXT"==t.type?[i("v-uni-view",{staticClass:"cu-info round"},[i("v-uni-rich-text",{attrs:{nodes:t.txt}})],1)]:"USER_CARD"==t.type?[t.fromUid==e.user.id?i("v-uni-view",{staticClass:"cu-item self"},[i("v-uni-view",{staticClass:"main"},[i("v-uni-view",{staticStyle:{border:"1px solid #eee","background-color":"#fff",width:"400upx",height:"180upx","border-radius":"6px"},on:{click:function(i){arguments[0]=i=e.$handleEvent(i),e.clickCard(t)}}},[i("v-uni-view",{staticStyle:{height:"130upx","border-bottom":"1px solid #eee",width:"90%",margin:"auto auto",display:"flex"}},[i("v-uni-view",{staticClass:"cu-avatar radius",staticStyle:{width:"80upx","margin-top":"26upx",height:"80upx"},style:"background-image:url("+e.imgUrl+t.mheadpic+");"}),i("v-uni-view",{staticStyle:{width:"240upx","margin-top":"30upx","margin-left":"12upx","text-align":"left"}},[i("v-uni-view",{staticStyle:{overflow:"hidden","word-break":"keep-all","text-overflow":"ellipsis"}},[e._v(e._s(t.mname))]),i("v-uni-view",{staticStyle:{color:"#bbb","font-size":"24upx","margin-top":"8upx"}},[e._v("ID："+e._s(t.mid))])],1)],1),i("v-uni-view",{staticStyle:{height:"50upx","line-height":"50upx","text-align":"left","font-size":"23upx","padding-left":"20upx",color:"#777"}},[e._v("个人名片")])],1)],1),i("v-uni-view",{staticClass:"cu-avatar radius",style:"background-image:url("+e.imgUrl+t.fromHeadpic+");"}),i("v-uni-view",{staticClass:"date"},[e._v(e._s(t.date))])],1):i("v-uni-view",{staticClass:"cu-item"},[i("v-uni-view",{staticClass:"cu-avatar radius",style:"background-image:url("+e.imgUrl+t.fromHeadpic+");",on:{click:function(i){i.stopPropagation(),arguments[0]=i=e.$handleEvent(i),e.goUserDetail(t.fromUid)}}}),i("v-uni-view",{staticClass:"main"},[i("v-uni-view",{staticStyle:{border:"1px solid #eee","background-color":"#fff",width:"400upx",height:"180upx","border-radius":"6px"},on:{click:function(i){arguments[0]=i=e.$handleEvent(i),e.clickCard(t)}}},[i("v-uni-view",{staticStyle:{height:"130upx","border-bottom":"1px solid #eee",width:"90%",margin:"auto auto",display:"flex"}},[i("v-uni-view",{staticClass:"cu-avatar radius",staticStyle:{width:"80upx","margin-top":"26upx",height:"80upx"},style:"background-image:url("+e.imgUrl+t.mheadpic+");"}),i("v-uni-view",{staticStyle:{width:"240upx","margin-top":"30upx","margin-left":"12upx","text-align":"left"}},[i("v-uni-view",{staticStyle:{overflow:"hidden","word-break":"keep-all","text-overflow":"ellipsis"}},[e._v(e._s(t.mname))]),i("v-uni-view",{staticStyle:{color:"#bbb","font-size":"24upx","margin-top":"8upx"}},[e._v("ID："+e._s(t.mid))])],1)],1),i("v-uni-view",{staticStyle:{height:"50upx","line-height":"50upx","text-align":"left","font-size":"23upx","padding-left":"20upx",color:"#777"}},[e._v("个人名片")])],1)],1),i("v-uni-view",{staticClass:"date "},[e._v(e._s(t.date))])],1)]:[t.fromUid==e.user.id?i("v-uni-view",{staticClass:"cu-item self"},[i("v-uni-view",{staticClass:"main"},[0==t.read?i("v-uni-view",{staticStyle:{"margin-right":"30upx",color:"#999","font-size":"24upx"}},[e._v("未读")]):e._e(),1==t.read?i("v-uni-view",{staticStyle:{"margin-right":"30upx",color:"#999","font-size":"24upx"}},[e._v("已读")]):e._e(),i("v-uni-view",{staticClass:"content bg-green shadow",staticStyle:{"background-color":"#98E165",color:"#222"}},["uparse"==t.psr?i("u-parse",{attrs:{content:t.txt},on:{preview:function(t){arguments[0]=t=e.$handleEvent(t),e.preview.apply(void 0,arguments)},navigate:function(t){arguments[0]=t=e.$handleEvent(t),e.navigate.apply(void 0,arguments)}}}):"voice"==t.psr?i("v-uni-view",{on:{click:function(i){arguments[0]=i=e.$handleEvent(i),e.clickVoice(t.txt,a)}}},[i("v-uni-text",{directives:[{name:"show",rawName:"v-show",value:e.selVoiceIndex!=a,expression:"selVoiceIndex != index"}],staticClass:"iconfont icon-yuyin1 text-xxl ",staticStyle:{float:"left",width:"100upx","font-size":"52upx",position:"relative",top:"4upx"}}),i("v-uni-text",{directives:[{name:"show",rawName:"v-show",value:e.selVoiceIndex!=a,expression:"selVoiceIndex != index"}],staticStyle:{float:"left","font-size":"26upx",position:"relative",top:"4upx"}},[e._v(e._s(t.sub_txt)+'"')]),i("v-uni-text",{directives:[{name:"show",rawName:"v-show",value:e.selVoiceIndex==a,expression:"selVoiceIndex == index"}],staticClass:"iconfont cu-load load-cuIcon loading text-xxl ",staticStyle:{float:"left",width:"100upx","font-size":"52upx",position:"relative","text-align":"left",top:"0","line-height":"38upx"}}),i("v-uni-text",{directives:[{name:"show",rawName:"v-show",value:e.selVoiceIndex==a,expression:"selVoiceIndex == index"}],staticStyle:{float:"left","font-size":"26upx",position:"relative",top:"6upx"}},[e._v(e._s(t.sub_txt)+'"')])],1):"video"==t.psr?i("v-uni-video",{attrs:{direction:"0",src:e.imgUrl+t.txt}}):i("v-uni-rich-text",{attrs:{nodes:t.txt}})],1)],1),i("v-uni-view",{staticClass:"cu-avatar radius",style:"background-image:url("+e.imgUrl+t.fromHeadpic+");"}),i("v-uni-view",{staticClass:"date"},[e._v(e._s(t.date))])],1):i("v-uni-view",{staticClass:"cu-item"},[i("v-uni-view",{staticClass:"cu-avatar radius",style:"background-image:url("+e.imgUrl+t.fromHeadpic+");",on:{click:function(i){i.stopPropagation(),arguments[0]=i=e.$handleEvent(i),e.goUserDetail(t.fromUid)}}}),i("v-uni-view",{staticClass:"main"},[i("v-uni-view",{staticClass:"content shadow",staticStyle:{color:"#222"}},["uparse"==t.psr?i("u-parse",{attrs:{content:t.txt},on:{preview:function(t){arguments[0]=t=e.$handleEvent(t),e.preview.apply(void 0,arguments)},navigate:function(t){arguments[0]=t=e.$handleEvent(t),e.navigate.apply(void 0,arguments)}}}):"voice"==t.psr?i("v-uni-view",{on:{click:function(i){arguments[0]=i=e.$handleEvent(i),e.clickVoice(t.txt,a)}}},[i("v-uni-text",{directives:[{name:"show",rawName:"v-show",value:e.selVoiceIndex!=a,expression:"selVoiceIndex != index"}],staticClass:"iconfont icon-yuyin1 text-xxl ",staticStyle:{"text-align":"right",float:"right",width:"100upx","font-size":"52upx",position:"relative",top:"4upx"}}),i("v-uni-text",{directives:[{name:"show",rawName:"v-show",value:e.selVoiceIndex!=a,expression:"selVoiceIndex != index"}],staticStyle:{float:"right","font-size":"26upx",position:"relative",top:"4upx"}},[e._v(e._s(t.sub_txt)+'"')]),i("v-uni-text",{directives:[{name:"show",rawName:"v-show",value:e.selVoiceIndex==a,expression:"selVoiceIndex == index"}],staticClass:"iconfont cu-load load-cuIcon loading text-xxl ",staticStyle:{"text-align":"right",float:"right",width:"100upx","font-size":"52upx",position:"relative",top:"0","line-height":"38upx"}}),i("v-uni-text",{directives:[{name:"show",rawName:"v-show",value:e.selVoiceIndex==a,expression:"selVoiceIndex == index"}],staticStyle:{float:"right","font-size":"26upx",position:"relative",top:"6upx"}},[e._v(e._s(t.sub_txt)+'"')])],1):"video"==t.psr?i("v-uni-video",{attrs:{direction:"0",src:e.imgUrl+t.txt}}):i("v-uni-rich-text",{attrs:{nodes:t.txt}})],1)],1),i("v-uni-view",{staticClass:"date "},[e._v(e._s(t.date))])],1)]]})),e.moreShow?i("v-uni-view",{staticStyle:{color:"rgb(170, 170, 170)","text-align":"center","margin-top":"30rpx","margin-bottom":"20rpx"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.loadmore.apply(void 0,arguments)}}},[e._v("点击加载更多...")]):e._e(),e.moreShow?e._e():i("v-uni-view",{staticStyle:{color:"rgb(170, 170, 170)","text-align":"center","margin-top":"30rpx","margin-bottom":"20rpx"}},[e._v("暂无更多...")])],2)],1)],1)},s=[]},"7baf":function(e,t,i){"use strict";i.r(t);var a=i("a88f"),r=i.n(a);for(var s in a)["default"].indexOf(s)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(s);t["default"]=r.a},"7bb8":function(e,t,i){"use strict";i.r(t);var a=i("6768"),r=i("7baf");for(var s in r)["default"].indexOf(s)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(s);var o=i("f0c5"),n=Object(o["a"])(r["default"],a["b"],a["c"],!1,null,"0ff6990b",null,!1,a["a"],void 0);t["default"]=n.exports},a88f:function(module,exports,__webpack_require__){"use strict";(function(console){__webpack_require__("7a82");var _interopRequireDefault=__webpack_require__("4ea4").default;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,__webpack_require__("14d9"),__webpack_require__("3c65"),__webpack_require__("e9c4"),__webpack_require__("99af");var _objectSpread2=_interopRequireDefault(__webpack_require__("5530")),_defineProperty2=_interopRequireDefault(__webpack_require__("ade3")),_uParse=_interopRequireDefault(__webpack_require__("81b6")),_utils=__webpack_require__("33cd"),_vuex=__webpack_require__("26cb"),_api=__webpack_require__("99bd"),_MessageType=__webpack_require__("7f8e"),innerAudioContext=uni.createInnerAudioContext(),_default={components:{uParse:_uParse.default},data:function(){var e;return e={toid:"",list:[],allList:[],player:null,selVoiceIndex:-1,domHeight:0,c_type:1,InputBottom:0},(0,_defineProperty2.default)(e,"toid",""),(0,_defineProperty2.default)(e,"entity",{}),(0,_defineProperty2.default)(e,"txt",""),(0,_defineProperty2.default)(e,"temp_txt",""),(0,_defineProperty2.default)(e,"moreShow",!0),(0,_defineProperty2.default)(e,"showjia",!0),(0,_defineProperty2.default)(e,"emotion",1),(0,_defineProperty2.default)(e,"showItem",0),(0,_defineProperty2.default)(e,"scrollTop",0),(0,_defineProperty2.default)(e,"style",{pageHeight:0,contentViewHeight:0,footViewHeight:90,mitemHeight:0}),(0,_defineProperty2.default)(e,"sendCount",0),(0,_defineProperty2.default)(e,"RECORDER",""),(0,_defineProperty2.default)(e,"AUDIO",uni.createInnerAudioContext()),(0,_defineProperty2.default)(e,"recordTimer",null),(0,_defineProperty2.default)(e,"recordLength",0),(0,_defineProperty2.default)(e,"voicePath",""),(0,_defineProperty2.default)(e,"isRecord",!1),(0,_defineProperty2.default)(e,"intervalTime",0),(0,_defineProperty2.default)(e,"timer",null),(0,_defineProperty2.default)(e,"v_base64",""),(0,_defineProperty2.default)(e,"winSize",{}),(0,_defineProperty2.default)(e,"showShade",!1),(0,_defineProperty2.default)(e,"showPop",!1),(0,_defineProperty2.default)(e,"popButton",["复制","转发","收藏","删除","撤消"]),(0,_defineProperty2.default)(e,"popButtonStore",["复制","转发","收藏","删除","撤消"]),(0,_defineProperty2.default)(e,"popStyle",""),(0,_defineProperty2.default)(e,"pickerUserIndex",-1),(0,_defineProperty2.default)(e,"chatLogs",[]),(0,_defineProperty2.default)(e,"temp_content",""),(0,_defineProperty2.default)(e,"temp_uuid",""),(0,_defineProperty2.default)(e,"chatCfg",{}),(0,_defineProperty2.default)(e,"temp_bean",null),(0,_defineProperty2.default)(e,"showOpenRed",!1),(0,_defineProperty2.default)(e,"showname",""),(0,_defineProperty2.default)(e,"refresherTriggered",!1),(0,_defineProperty2.default)(e,"_refresherTriggered",!1),(0,_defineProperty2.default)(e,"numPag",1),(0,_defineProperty2.default)(e,"allPageNum",1e4),(0,_defineProperty2.default)(e,"pageSize",50),(0,_defineProperty2.default)(e,"status","more"),(0,_defineProperty2.default)(e,"pageParams",{pageNumber:"1",pageCount:"30"}),(0,_defineProperty2.default)(e,"timer",null),(0,_defineProperty2.default)(e,"syncMessageArr",[]),e},onLoad:function(e){this.toid=e.id;this.tongbuMsg(this.pageParams.pageCount,this.pageParams.pageNumber)},computed:(0,_objectSpread2.default)((0,_objectSpread2.default)((0,_objectSpread2.default)({i18n:function(){return this.$t("index")}},(0,_vuex.mapState)("chat",["curChatEntity","curChatMsgList","chatMessageMap"])),(0,_vuex.mapState)("app",["imgUrl"])),(0,_vuex.mapState)("user",["user"])),methods:(0,_objectSpread2.default)((0,_objectSpread2.default)({},(0,_vuex.mapMutations)("chat",["setCurChatEntity","setCurChatMsgList","updateChatMessageMap","setTempBean"])),{},{loadmore:function(){this.pageParams.pageNumber++,this.tongbuMsg(this.pageParams.pageCount,this.pageParams.pageNumber)},refresherrefresh:function(){console.log("自定义下拉刷新被触发");this._refresherTriggered||(this._refresherTriggered=!0,this.refresherTriggered||(this.refresherTriggered=!0),this.pageParams.pageNumber++,this.loadStoreData(this.pageParams.pageCount,this.pageParams.pageNumber))},refresherrestore:function(){console.log("自定义下拉刷新被复位");this.refresherTriggered=!1,this._refresherTriggered=!1},refresherabort:function(){console.log("自定义下拉刷新被中止    ");this.refresherTriggered=!1,this._refresherTriggered=!1},scrollLower:function(){console.log("我滚动到底部了")},closeRefresh:function(){this.refresherTriggered=!1,this._refresherTriggered=!1},tongbuMsg:function tongbuMsg(){var _this2=this,_this=this;uni.showLoading(),(0,_api.syncMsgData)({chatid:_this.curChatEntity.id,pageNumber:this.pageParams.pageNumber}).then((function(res){var res_data=eval(res.data);if(201==res_data.code)setTimeout((function(){_this2.moreShow=!1,uni.hideLoading(),uni.showToast({title:"暂无更多",icon:"none"})}),400);else if(200==res_data.code){if(res_data.body&&0!=res_data.body.records.length){for(var cList=[],i=0;i<res_data.body.records.length;i++)cList.push(res_data.body.records[i][0]);_this.syncMessageArr.unshift.apply(_this.syncMessageArr,cList);var user=uni.getStorageSync("USER");_this.setCurChatMsgList([]),_this.setCurChatMsgList(_this.syncMessageArr),_this.chatMessageMap.has(user.id+"#"+_this2.toid)&&_this.updateChatMessageMap({key:user.id+"#"+_this2.toid,value:_this2.curChatMsgList}),0!=_this.curChatMsgList.length&&_this.curChatMsgList[_this.curChatMsgList.length-1].bean.simple_content,uni.setStorageSync(user.id+"#"+_this2.toid+"_CHAT_MESSAGE",JSON.stringify(_this.curChatMsgList))}if(_this.pageParams=res_data.body,_this.pageParams.pageNumber>1){for(var _i=0;_i<res_data.body.records.length;_i++)res_data.body.records[_i]=res_data.body.records[_i][0].bean;_this.chatLogs=_this.chatLogs.concat(res_data.body.records),uni.hideLoading()}else uni.hideLoading(),_this.chatLogs=res_data.body.records;for(var _i2=0;_i2<_this.chatLogs.length;_i2++)_this.chatLogs[_i2]=_this.chatLogs[_i2][0].bean;setTimeout((function(){uni.hideLoading()}),400)}})).catch((function(e){console.log("err=>",e)}))},loadStoreData:function loadStoreData(pSize,pNumber){var _this3=this,_this=this,user=uni.getStorageSync("USER");user&&(0,_api.listPage)({pageSize:pSize,pageNumber:pNumber,toMemberid:_this.curChatEntity.id}).then((function(res_1){var res_data_1=eval(res_1.data);200==res_data_1.code?(_this3.pageParams.pageNumber=res_data_1.body.pageNumber,_this3.pageParams.pageNumber>1?_this.allList=_this.allList.concat(res_data_1.body.records):_this.allList=res_data_1.body.records,_this3.closeRefresh()):_this3.closeRefresh()}))},getPopButton:function(e){return"复制"==e?"icon-fuzhi":"转发"==e?"icon-zhuanfa":"收藏"==e?"icon-collection-b":"删除"==e?"icon-shanchu":"撤消"==e?"icon-shangjiachexiaoshenqingrenzhengliebiao":""},clickCard:function(e){this.goUserDetail(e.muuid)},sendCard:function(){this.showPop=!1,this.showItem=0,this.InputBottom=0,uni.navigateTo({url:"/pages/chat/card/sendCard"}),this.setTempBean(this.entity)},goFavourite:function(){uni.navigateTo({url:"/pages/mine/favourite_list"})},clickChat:function(){this.showPop=!1,this.showItem=0,this.InputBottom=0},scrollToBottom:function(){setTimeout((function(){uni.pageScrollTo({scrollTop:9999999999,duration:0})}),100)},clickVoice:function(e,t){var i=this;if(this.selVoiceIndex==t)return this.selVoiceIndex=-1,void(this.player&&(this.player.stop(),console.log("停止了")));this.selVoiceIndex=t,this.player=plus.audio.createPlayer(e),this.player.play((function(){i.selVoiceIndex=-1,console.log("播放完了")}),(function(e){console.log("播放失败")}))},getWindowSize:function(){var e=this;uni.getSystemInfo({success:function(t){e.winSize={witdh:t.windowWidth,height:t.windowHeight}}})},goUserDetail:function(e){uni.navigateTo({url:"/pages/chat/user_detail?id="+e})}})};exports.default=_default}).call(this,__webpack_require__("5a52")["default"])}}]);